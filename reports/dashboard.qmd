--- 
title: "í™”ì¬ ë³´í—˜ ì‚°ì •"
author: "6ì¡° : êµ¬ê²½ë¯¼, ì‹ íƒœì„ , ì˜¤ìœ¤ì§€, ì´ì¬ìš°"
format: 
  dashboard:
    theme: flatly
    css: red-white.css
--- 

# 0. ë“¤ì–´ê°€ëŠ” ë§

## Row {height=50%}

### Column {width=50%}
::: {.card title="Ames Fire Insurance"}
<img src="images/ames.png" style="width: 100%; height: auto; border-radius: 12px;" />
:::

### Column {width=50%}
::: {.card title="ğŸ”¥ ìš°ë¦¬ëŠ” LS í™”ì¬ë³´í—˜ì‚¬"}

ì—ì„ì¦ˆ(Ames) ì‹œì— **ìƒˆë¡œìš´ ë³´í—˜ìƒí’ˆ**ì„ ì¶œì‹œí•˜ë ¤ í•©ë‹ˆë‹¤.  
ê·¸ëŸ°ë° ì´ ì§€ì—­ì€ **ìì¬ë³„ í™”ì¬ ìœ„í—˜ë„**ê°€ ì–´ë–¤ì§€,  
**ë³´í—˜ê¸ˆì€ ì–¼ë§ˆë¡œ ì±…ì •í•´ì•¼** ìˆ˜ìµì´ ë‚  ìˆ˜ ìˆì„ì§€,  
ì•„ë¬´ë„ ì •í™•íˆ ëª¨ë¦…ë‹ˆë‹¤.

- ğŸ“¦ ì£¼íƒ ê°€ê²©ì€ ì–´ë–¤ì§€  
- ğŸ§± ìì¬ì— ë”°ë¥¸ í™”ì¬ ìœ„í—˜ë„ëŠ” ì–´ë–¤ì§€  
- ğŸ”¥ í™”ì¬ ìœ„í—˜ë„ì™€ ê°€ê²©ì˜ ê´€ê³„ê°€ ì–´ë–¤ì§€ 
- ğŸ’° ë³´í—˜ ìˆ˜ìµì€ ì–´ë””ì„œ ë°œìƒí•˜ëŠ”ì§€  

**ì´ì œ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ,  
ì—ì„ì¦ˆ ì‹œì˜ ë³´í—˜ë£Œë¥¼ ì§ì ‘ ì‚°ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.**

:::


## Row {height=50%}
### Column {width=50%}
::: {.card title="ğŸ“Œ í”„ë¡œì íŠ¸ ë°°ê²½"}

ìµœê·¼ **ê¸°í›„ ë³€í™”**ì™€ **ë…¸í›„í™”ëœ ì£¼íƒ** ë¬¸ì œë¡œ,  
ë¯¸êµ­ ë‚´ í™”ì¬ ì‚¬ê³ ê°€ ì¦ê°€í•˜ê³  ìˆìŠµë‹ˆë‹¤.  
ìº˜ë¦¬í¬ë‹ˆì•„ ì‚°ë¶ˆ ì‚¬ë¡€ì²˜ëŸ¼, ë³´í—˜ì‚¬ëŠ” ë§‰ëŒ€í•œ ì†ì‹¤ì„ ì…ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ë ‡ë‹¤ë©´, ìš°ë¦¬ëŠ” **ì‚¬ì „ ì˜ˆì¸¡ê³¼ ë¦¬ìŠ¤í¬ ë¶„ì„ì„ í†µí•´**  
ë³´ë‹¤ ì •ë°€í•œ ë³´í—˜ë£Œ ì±…ì •ì´ ê°€ëŠ¥í• ê¹Œìš”?

**Ames Housing ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ  
ë°ì´í„° ê¸°ë°˜ í™”ì¬ë³´í—˜ ëª¨ë¸ì„ êµ¬ì¶•í•©ë‹ˆë‹¤.**
:::


### Column {width=50%}
::: {.card title="ğŸ§­ ë¶„ì„ íë¦„ ìš”ì•½"}
1ï¸âƒ£ **í™”ì¬ ìœ„í—˜ ì§€ì—­ ì‹œê°í™”**  
2ï¸âƒ£ **í¬ê¸° ëŒ€ë¹„ ê°€ê²© ë¶„í¬ ë¶„ì„**  
3ï¸âƒ£ **í™”ì¬ ìœ„í—˜ ì§€í‘œì™€ ê°€ê²© ìƒê´€ê´€ê³„ ë¶„ì„**  
4ï¸âƒ£ **ë³´í—˜ë£Œ ì‚°ì • ëª¨ë¸ë§**  
5ï¸âƒ£ **ì†ìµë¶„ê¸°ì  ë¶„ì„**  
:::

# 1. í™”ì¬ ìœ„í—˜ ì§€ì—­ ì‹œê°í™”

## Row {height=60%}

### Column {width=60%}
::: {.card title="ğŸ—ºï¸ 1. ìœ„í—˜ë„ ê¸°ë°˜ ì£¼íƒ ì‹œê°í™”"}
```{python}
#| echo: false
import os
import shutil
import numpy as np
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
import warnings
import scipy as sp
import scipy.stats as st
import statsmodels.api as sm
from statsmodels.formula.api import ols
import statsmodels.formula.api as smf
from sklearn.preprocessing import PolynomialFeatures
from sklearn.linear_model import LinearRegression, Ridge, Lasso, RidgeCV, LassoCV
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import PolynomialFeatures
from sklearn.metrics import mean_squared_error, root_mean_squared_error
from sklearn.impute import SimpleImputer
from sklearn.datasets import load_iris
from sklearn import linear_model
from tqdm import tqdm
warnings.filterwarnings('ignore')

os.chdir('../src')
from dataloader import DataLoader

# load data 

dataloader = DataLoader()
dataset = dataloader.load_data()
```

```{python}
#| echo: false
import pandas as pd
import plotly.graph_objects as go

dataset['PricePerArea'] = dataset['SalePrice'] / dataset['LotArea']
# ---------------------------
# ğŸ’° ì§€ì—­ë³„ 'í‰ë‹¨ê°€' ê¸°ë°˜ ë“±ê¸‰ ë¶„ë¥˜ (5ë‹¨ê³„)
# ---------------------------
price_per_area_by_neigh = dataset['PricePerArea']
q20 = price_per_area_by_neigh.quantile(0.20)
q40 = price_per_area_by_neigh.quantile(0.40)
q60 = price_per_area_by_neigh.quantile(0.60)
q80 = price_per_area_by_neigh.quantile(0.80)

def classify_price_grade(price):
    if price <= q20:
        return 1
    elif price <= q40:
        return 2
    elif price <= q60:
        return 3
    elif price <= q80:
        return 4
    else:
        return 5



#  ìœ„í—˜ë„ í‰ê·  ì—´ ìƒì„±
dataset['Risk_Avg'] = (
    dataset['Risk_RoofMatl'] * 0.30 +
    dataset['Risk_Exterior1st'] * 0.30 +
    dataset['Risk_Exterior2nd'] * 0.10 +
    dataset['Risk_MasVnrType'] * 0.10 +
    dataset['Risk_WoodDeckSF'] * 0.2
)

# ìœ„í—˜ë„ í‰ê· ì„ 5ë‹¨ê³„ë¡œ ê·¸ë£¹í™”
dataset['Risk_Level'] = dataset['Risk_Avg'].round()

# í™”ì¬ ìœ„í—˜ë„ë³„ í‰ë‹¨ê°€ ë‘ê°œë‹¤ ë§‰ëŒ€ê·¸ë˜í”„ë¡œ ê·¸ë˜í”„ ê·¸ë¦¬ê¸° í•„ìš” ì½”ë“œ
mean_RiskLevel = dataset.groupby('Risk_Level')['BuildingPricePerTotalSF'].mean()

# ì¤‘ì•™ê°’ í‰ë‹¨ê°€ ë°” ê·¸ë˜í”„ ê·¸ë¦¬ê¸° ìœ„í•´ í•„ìš” ì½”ë“œ
median_RiskLevel = dataset.groupby('Risk_Level')['BuildingPricePerTotalSF'].median()

# ê²°ì¸¡ê°’ ì œê±°

dataset = dataset.dropna(subset=['BuildingPricePerTotalSF'])

dataset1 = dataset

color_map = {
    1: '#ffffff',   # White
    2: '#ffe5e5',   # Very light pink
    3: '#ff9999',   # Light red
    4: '#ff4d4d',   # Red-orange
    5: '#cc0000'    # Deep red
}


layout_mapbox = dict(
    mapbox=dict(
        style="open-street-map",  # ğŸ’¡ ê¹”ë”í•œ ê¸°ë³¸ ìŠ¤íƒ€ì¼
        center=dict(lat=42.0345, lon=-93.62),
        zoom=11
    ),
    title=dict(
        text='ğŸ”¥ Ames ì‹œ í™”ì¬ ìœ„í—˜ë„ ê¸°ë°˜ ì£¼íƒ ì‹œê°í™”',
        font=dict(size=22, color='black'),
        x=0.05,
        xanchor='left'
    ),
    margin=dict(l=20, r=20, t=60, b=20),
    legend=dict(
        title=dict(
            text='<b>ìœ„í—˜ë„ ë¶„ë¥˜</b>',
            side='top'
        ),
        orientation='h', 
        yanchor='bottom', 
        y=0.02, 
        xanchor='center', 
        x=0.5, 
        bgcolor='rgba(255, 255, 255, 0.8)', 
        bordercolor='rgba(200, 200, 200, 0.8)', 
        borderwidth=1,
        font=dict(size=12),
        itemwidth=50,
        entrywidth=80,
        valign='middle',
        traceorder='normal',
        itemsizing='constant',
    )
)

# ì£¼íƒ ë§ˆì»¤
traces = []
for level, color in color_map.items():
    df = dataset[dataset['Risk_Level'] == level]
    traces.append(go.Scattermapbox(
        lat=df['Latitude'], lon=df['Longitude'],
        mode='markers',
        marker=dict(size=7, color=color, opacity=0.6),
        text='ê°€ê²©: $' + df['SalePrice'].astype(str) + '<br>ìœ„í—˜ë„: ' + df['Risk_Level'].astype(str),
        name=f'ìœ„í—˜ë„ {level}'
    ))


# ì‹œê°í™”
fig1 = go.Figure(data=traces, layout=layout_mapbox)
fig1.show()

```
:::


### Column {width=40%}


::: {.card title="ğŸ“‹ 2. í™”ì¬ ìœ„í—˜ë„ ì‚°ì • ê¸°ì¤€í‘œ"}

<div style="font-size: 13px; overflow-x: auto;">

|  | ìœ„í—˜ë„1 | ìœ„í—˜ë„2 | ìœ„í—˜ë„3 | ìœ„í—˜ë„4 | ìœ„í—˜ë„5 |
| --- | --- | --- | --- | --- | --- |
| ì§€ë¶• ìì¬ (30%) | Metal | CompShg, Tar&Grv | Roll,    Membran | WdShngl | WdShake |
| ì™¸ë²½ ì¬ì§ˆ(30%) | MetalSd, CemntBd, BrkFace... | ImStucc,Stucco | VinylSd, | HdBoard, AsphShn | Wd Sdng, WdShing, Plywood |
| ì™¸ë²½ ì¥ì‹ ì¬ì§ˆ(10%) | MetalSd,CemntBd,BrkFace... | Stucco, ImStucc | VinylSd | HdBoard, AsphShn | Wd Sdng, WdShing, Plywood |
| ì™¸ë²½ ë§ˆê°ì¬(10%) | BrkFace,Stone,BrkCmn |  |  |  |  |
| ëª©ì¬ ë°”ë‹¥ ë„“ì´(20%) | 0 | 1~100 | 101~250 | 251~400 | 400 |

- **ì§€ë¶•ê³¼ ì™¸ë²½**ì€ í™”ì¬ ì‹œ ê°€ì¥ ë¨¼ì € íƒ€ëŠ” **1ì°¨ì  ì·¨ì•½ ìš”ì†Œ**ì…ë‹ˆë‹¤.  
- **ëª©ì¬ ë°”ë‹¥**ì€ ë¶ˆì”¨ì— ì‰½ê²Œ ì°©í™”ë˜ë©°,  
- **ì™¸ë²½ ë§ˆê°ì¬ì™€ ì¥ì‹**ì€ ìƒëŒ€ì ìœ¼ë¡œ ìœ„í—˜ë„ëŠ” ë‚®ì§€ë§Œ **ê°€ì—°ì„±ì¼ ê²½ìš° ì£¼ì˜ê°€ í•„ìš”**í•©ë‹ˆë‹¤.

ğŸ“ ìì„¸í•œ ê¸°ì¤€ì€ NFPA ê³µì‹ ê°€ì´ë“œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ğŸ”— [NFPA - Preparing Homes for Wildfire](https://www.nfpa.org/education-and-research/wildfire/preparing-homes-for-wildfire)
</div>

:::

#### Row {height=50%}

::: {.card title="ğŸ“Š 3. ìœ„í—˜ë„ë³„ ì£¼íƒìˆ˜ëŸ‰ ë§‰ëŒ€ê·¸ë˜í”„"}
```{python}
#| echo: false

cnt_RiskLevel = dataset['Risk_Level'].value_counts().sort_index()

fig, ax = plt.subplots(figsize=(6, 4))
cnt_RiskLevel.plot(kind='bar', color='skyblue', edgecolor='black', ax=ax)

# í…ìŠ¤íŠ¸ ì„¤ì • (ë°˜í™˜ê°’ ë¬´ì‹œ)
_ = ax.set_xlabel('Risk_Level')
_ = ax.set_ylabel('# of house by risk level')
_ = ax.set_title('Risk_level_house_cnt')
_ = ax.set_xticks(range(len(cnt_RiskLevel)))
_ = ax.set_xticklabels(cnt_RiskLevel.index.astype(str))
_ = ax.grid(axis='y', linestyle='--', alpha=0.5)
_ = plt.xticks(rotation=0)

plt.show()
```
:::


# 2. í¬ê¸° ëŒ€ë¹„ ê°€ê²© ë¶„í¬ ë¶„ì„

## Row {height=60%}


::: {.card title="ğŸ“Š 1. ê°€ê²© & í‰ë‹¨ ê°€ê²© ì‹œê°í™”"}

::: {.panel-tabset}

#### ê±°ë˜ê°€ê²© ì§€ë„
```{python}
#| echo: false
# ---------------------------
# ğŸ’° ê°€ê²© ë“±ê¸‰ ë¶„ë¥˜ (5ë‹¨ê³„)
# ---------------------------
price_by_neigh = dataset.groupby('Neighborhood')['SalePrice'].mean()
q20 = price_by_neigh.quantile(0.20)
q40 = price_by_neigh.quantile(0.40)
q60 = price_by_neigh.quantile(0.60)
q80 = price_by_neigh.quantile(0.80)

def classify_price_grade(neighborhood):
    price = price_by_neigh[neighborhood]
    if price <= q20:
        return 'Very Low'
    elif price <= q40:
        return 'Low'
    elif price <= q60:
        return 'Normal'
    elif price <= q80:
        return 'High'
    else:
        return 'Very High'

dataset['PriceGrade'] = dataset['Neighborhood'].apply(classify_price_grade)

# ---------------------------
# ğŸ¨ ìƒ‰ìƒ ë§¤í•‘
# ---------------------------
color_map = {
    'Very Low': '#ffffff',  # í°ìƒ‰
    'Low': '#cce5ff',       # ì—°í•œ í•˜ëŠ˜ìƒ‰
    'Normal': '#6699cc',    # ì¤‘ê°„ íŒŒë‘
    'High': '#3366cc',      # ì§„í•œ íŒŒë‘
    'Very High': '#000080'  # ë„¤ì´ë¹„
}

# ---------------------------
# ğŸ§­ ì§€ë„ ì„¤ì •
# ---------------------------
layout_mapbox = dict(
    mapbox=dict(
        style="open-street-map",  # ğŸ’¡ ê¹”ë”í•œ ê¸°ë³¸ ìŠ¤íƒ€ì¼
        center=dict(lat=42.0345, lon=-93.62),
        zoom=11
    ),
    title=dict(
        text='ğŸ’²Ames ì‹œ ë¶€ë™ì‚° ê±°ë˜ê°€ê²©',
        font=dict(size=22, color='black'),
        x=0.05,
        xanchor='left'
    ),
    margin=dict(l=20, r=20, t=60, b=20),
    legend=dict(
        title=dict(
            text='<b>ë¶€ë™ì‚° ê±°ë˜ê°€ê²©</b>',
            side='top'
        ),
        orientation='h', 
        yanchor='bottom', 
        y=0.02, 
        xanchor='center', 
        x=0.5, 
        bgcolor='rgba(255, 255, 255, 0.8)', 
        bordercolor='rgba(200, 200, 200, 0.8)', 
        borderwidth=1,
        font=dict(size=12),
        itemwidth=50,
        entrywidth=80,
        valign='middle',
        traceorder='normal',
        itemsizing='constant',
    )
)

# ---------------------------
# ğŸ¡ ì£¼íƒ ë§ˆì»¤ (ë“±ê¸‰ë³„ ë¶„ë¦¬)
# ---------------------------
home_traces = []
for grade, color in color_map.items():
    subset = dataset[dataset['PriceGrade'] == grade]
    trace = go.Scattermapbox(
        lat=subset['Latitude'],
        lon=subset['Longitude'],
        mode='markers',
        marker=dict(size=7, color=color, opacity=0.6),
        text='ê±°ë˜ì•¡ : $' + subset['SalePrice'].astype(int).astype(str),
        name=f"{grade} Area"
    )
    home_traces.append(trace)



fig2 = go.Figure(data=home_traces, layout=layout_mapbox)
fig2.show()  # â† ì´ ì¤„ì´ ë°˜ë“œì‹œ ìˆì–´ì•¼ í•©ë‹ˆë‹¤!

```

#### Ames í”¼íŠ¸ë‹¹ ê±°ë˜ ê°€ê²©

```{python}
#| echo: false

# âœ… ì´ ê±´ë¬¼ ë©´ì  ê³„ì‚°
# TotalSF = TotalBsmtSF + 1stFlrSF + 2ndFlrSF
# â†’ ì§€í•˜ + 1ì¸µ + 2ì¸µì„ í•©ì¹œ ì´ ì—°ë©´ì  (í‰ë‹¨ê°€ ê³„ì‚° ê¸°ì¤€)
dataset['TotalSF'] = dataset['TotalBsmtSF'] + dataset['1stFlrSF'] + dataset['2ndFlrSF']

# âœ… ê°€ì¤‘ í‰ê·  ê¸°ë°˜ LandValue, BuildingValue ê³„ì‚°
alpha = 0.4  # ë•…ê³¼ ê±´ë¬¼ì˜ ìƒëŒ€ì  ì¤‘ìš”ë„

# denominator = Î± Ã— LotArea + (1 - Î±) Ã— TotalSF
# â†’ ì „ì²´ ë©´ì  ì¤‘ ë•…ê³¼ ê±´ë¬¼ì´ ì°¨ì§€í•˜ëŠ” ê°€ì¤‘í•© (ê°€ê²© ë¶„ë°° ê¸°ì¤€)
denominator = alpha * dataset['LotArea'] + (1 - alpha) * dataset['TotalSF']

# LandValue = (Î± Ã— LotArea) / (denominator) Ã— SalePrice
# â†’ ì „ì²´ ì£¼íƒ ê°€ê²© ì¤‘ ë•… ë©´ì ì´ ì°¨ì§€í•˜ëŠ” ë¹„ì¤‘ë§Œí¼ì„ ë•…ê°’ìœ¼ë¡œ ë¶„ë°°
dataset['LandValue'] = (alpha * dataset['LotArea']) / denominator * dataset['SalePrice']

# BuildingValue = SalePrice - LandValue
# â†’ ì „ì²´ ì§‘ê°’ì—ì„œ ë•…ê°’ì„ ë¹¼ê³  ë‚¨ì€ ê²ƒì´ ê±´ë¬¼ê°’ (ì¦‰, í”¼í•´ ëŒ€ìƒ)
dataset['BuildingValue'] = dataset['SalePrice'] - dataset['LandValue']

# âœ… ê±´ë¬¼ í‰ë‹¨ê°€ ê³„ì‚°
# BuildingPricePerTotalSF = BuildingValue / TotalSF
# â†’ ê±´ë¬¼ 1í‰ë‹¹ ë‹¨ê°€ = ì‹¤ì œ í™”ì¬ í”¼í•´ ì¶”ì • ë‹¨ê°€    
dataset['BuildingPricePerTotalSF'] = (dataset['BuildingValue'] / dataset['TotalSF'])* 35.5832  # (1í‰ = 3.305 mÂ², 1mÂ² = 35.5832$)


# âœ… ë“±ê¸‰í™” (5ë¶„ìœ„)
q20 = dataset['BuildingPricePerTotalSF'].quantile(0.20)
q40 = dataset['BuildingPricePerTotalSF'].quantile(0.40)
q60 = dataset['BuildingPricePerTotalSF'].quantile(0.60)
q80 = dataset['BuildingPricePerTotalSF'].quantile(0.80)

def classify_price_grade(x):
    if x <= q20:
        return 'Very Low'
    elif x <= q40:
        return 'Low'
    elif x <= q60:
        return 'Normal'
    elif x <= q80:
        return 'High'
    else:
        return 'Very High'

dataset['PriceGrade'] = dataset['BuildingPricePerTotalSF'].apply(classify_price_grade)

# âœ… ìƒ‰ìƒ ë§¤í•‘
color_map = {
    'Very Low': '#ffffff',  # í°ìƒ‰
    'Low': '#cce5ff',       # ì—°í•œ í•˜ëŠ˜ìƒ‰
    'Normal': '#6699cc',    # ì¤‘ê°„ íŒŒë‘
    'High': '#3366cc',      # ì§„í•œ íŒŒë‘
    'Very High': '#000080'  # ë„¤ì´ë¹„
}

# âœ… ì†Œë°©ì„œ ìœ„ì¹˜ ë°ì´í„°
fire_stations = pd.DataFrame({
    'Name': ['Station 1', 'Station 2', 'Station 3'],
    'Latitude': [42.034862, 42.021596, 42.001115],
    'Longitude': [-93.615031, -93.649759, -93.609166]
})

layout_mapbox = dict(
    mapbox=dict(
        style="open-street-map",  # ğŸ’¡ ê¹”ë”í•œ ê¸°ë³¸ ìŠ¤íƒ€ì¼
        center=dict(lat=42.0345, lon=-93.62),
        zoom=11
    ),
    title=dict(
        text='ğŸ’²Ames ì‹œ ë¶€ë™ì‚° í‰ë‹¹ ê±°ë˜ê°€ê²©',
        font=dict(size=22, color='black'),
        x=0.05,
        xanchor='left'
    ),
    margin=dict(l=20, r=20, t=60, b=20),
    legend=dict(
        title='<b>í‰ë‹¹ ë¶€ë™ì‚° ê±°ë˜ê°€ê²©</b>', 
        orientation='h', 
        yanchor='bottom', 
        y=0.02, 
        xanchor='center', 
        x=0.5, 
        bgcolor='rgba(255, 255, 255, 0.8)', 
        bordercolor='rgba(200, 200, 200, 0.8)', 
        borderwidth=1,
        font=dict(size=12),
        itemwidth=100,
        valign='middle',
        traceorder='normal',
        itemsizing='constant'
    )
)

# âœ… ì£¼íƒ ë§ˆì»¤
home_traces = []
for grade, color in color_map.items():
    subset = dataset[dataset['PriceGrade'] == grade]
    trace = go.Scattermapbox(
        lat=subset['Latitude'],
        lon=subset['Longitude'],
        mode='markers',
        marker=dict(size=10, color=color, opacity=0.6),
        text='ì´ê°€:$' + subset['SalePrice'].astype(int).astype(str) +
             '<br>ê±´ë¬¼ í‰ë‹¹ ë‹¨ê°€:$' + subset['BuildingPricePerTotalSF'].round(1).astype(str),
        name=f"{grade} Area"
    )
    home_traces.append(trace)


# âœ… ì§€ë„ ì¶œë ¥
fig3 = go.Figure(data=home_traces, layout=layout_mapbox)


fig3.show()
```
:::

:::

### Column {width=40%}

::: {.card title="ğŸ“ 2. í‰ë‹¹ ë‹¨ê°€"}

- $F = \frac{BV}{LA} \cdot  35.5832$

- $BV = SP - LV$

- $LV = (\alpha \cdot LA)/ DM \cdot SP$

- $DM = \alpha \cdot LA + (1-\alpha)\cdot \operatorname{TotalSF}$

- $\operatorname{TotalSF} = \sum_{i=0}^N SF_i$
---
- $F$: í”¼íŠ¸ë‹¹ ê°€ê²©
- $BV$: ë¹Œë”© ê°€ê²©
- $LA$: ì „ì²´ ë©´ì 
- $SP$: ë¶€ë™ì‚° ì‹¤ê±°ë˜ê°€
- $LV$: ë•…ê°’
- $\alpha(=0.6)$: ë•…ê°’ê³¼ ê±´ë¬¼ì— ëŒ€í•œ ê°€ì¤‘ì¹˜
- $DM$: denominator
- $\operatorname{TotalSF}$: ì´ ê±´ë¬¼ ë©´ì 
- $SF_i$: ê° ì¸µì˜ ì´ë©´ì ($i = \{0, ..., N \} = \{ì§€í•˜, 1ì¸µ, 2ì¸µ \}$)
:::

::: {.card title="ğŸ“‰ 3. ê°€ê²© ë¶„í¬ ë§‰ëŒ€ê·¸ë˜í”„"}
```{python}
#| echo: false
import matplotlib.pyplot as plt
import seaborn as sns

# âœ… í•œê¸€ í°íŠ¸ ì„¤ì •
plt.rcParams['font.family'] = 'Malgun Gothic'  # ìœˆë„ìš°ìš©
# plt.rcParams['font.family'] = 'AppleGothic'  # Macìš©
plt.rcParams['axes.unicode_minus'] = False     # ë§ˆì´ë„ˆìŠ¤ ê¹¨ì§ ë°©ì§€

# âœ… íˆìŠ¤í† ê·¸ë¨ ê·¸ë¦¬ê¸°
plt.figure(figsize=(10, 5))
sns.histplot(
    data=dataset,
    x='BuildingPricePerTotalSF',
    bins=30,
    color='#6699cc',
    edgecolor='black'
)

# âœ… ì œëª©ê³¼ ì¶• ë ˆì´ë¸”
_ = plt.title( " ê±´ë¬¼ í‰ë‹¨ê°€ ë¶„í¬", fontsize=14)
_ = plt.xlabel("ê±´ë¬¼ í‰ë‹¨ê°€ ($/í‰)", fontsize=12)
_ = plt.ylabel("ì£¼íƒ ìˆ˜", fontsize=12)
_ = plt.grid(axis='y', linestyle='--', alpha=0.5)

plt.tight_layout()
plt.show()

```
:::

## Row {height=20%}
::: {.card title="ğŸ“ 1ì— ëŒ€í•œ í•´ì„"}
- ê¸°ì¡´ ë°ì´í„°ì…‹ì˜ ê±°ë˜ê¸ˆì•¡(SalePrice)ì€ ë•… ë©´ì ì´ë‚˜ ê±´ë¬¼ í¬ê¸° ë“±ì˜ ìš”ì†Œë¥¼ ë°˜ì˜í•˜ì§€ ì•Šì€ ì´ì•¡ ê¸°ì¤€

- ìš°ë¦¬ëŠ” ì´ë¥¼ ë³´ì™„í•˜ê¸° ìœ„í•´ **ë•…ì˜ ë©´ì (LotArea)**ê³¼ **ê±´ë¬¼ì˜ ì´ë©´ì (TotalSF)**ì„ ê³ ë ¤í•˜ì—¬
**ë‹¨ìœ„ ë©´ì ë‹¹ ê°€ì¹˜(í‰ë‹¨ê°€)**ë¡œ ì¬êµ¬ì„±í•¨

- ì´ë¡œ ì¸í•´ ë‹¨ìˆœ ë¶€ë™ì‚° ê±°ë˜ê¸ˆì•¡ì´ ì•„ë‹Œ ì‹¤ì œ ìì‚° ê°€ì¹˜ ê¸°ë°˜ì˜ ì§€ì—­ íŠ¹ì„±ì„ ë°˜ì˜í•  ìˆ˜ ìˆì—ˆìŒ

- ê²°ê³¼ì ìœ¼ë¡œ, ë¶€ì´Œ ì§€ì—­ê³¼ ì¼ë°˜ ì§€ì—­ ê°„ì˜ ê°€ì¹˜ ë¶„í¬ ì°¨ì´ê°€ ë‘ ì§€ë„ë¡œ ëª…í™•íˆ êµ¬ë¶„ë¨
:::





# 3. í™”ì¬ ìœ„í—˜ ì§€í‘œì™€ ê°€ê²© ìƒê´€ê´€ê³„ ë¶„ì„




## Row {height=40%}

::: {.card title="ğŸ“Š ìœ„í—˜ë“±ê¸‰ì— ë”°ë¥¸ ì£¼íƒê°€ê²© (ëª¨ìˆ˜)"}

::: {.panel-tabset}

####  â“ ANOVA ê²€ì •
- ìœ„í—˜ë„ë³„ ê°€ê²© í‰ê·  ì°¨ì´ ìˆìŒ

```{python}
#|echo : false
dataset1 = dataset1[dataset1['Risk_Level'] != 5]
dataset = dataset1


# ë¶„ì‚°ë¶„ì„ ê³¼ì •
import statsmodels.api as sm
from statsmodels.formula.api import ols


model = ols('BuildingPricePerTotalSF ~ C(Risk_Level)',data=dataset).fit()
anova_results = sm.stats.anova_lm(model, typ=2)

# ì•„ë…¸ë°” ê²€ì • ê²°ê³¼
print("anova result: ", anova_results)
```

#### âŒ ìƒ¤í”¼ë¡œ ìœŒí¬ ê²€ì •
```{python}
import scipy.stats as sp
W, p = sp.shapiro(model.resid)
# ì•„ë…¸ë°” ê²€ì • ê²°ê³¼
# ì”ì°¨ ì •ê·œì„± ê²€ì • ê²°ê³¼ ì¶œë ¥í•´ì•¼í•˜ëŠ” ë‚´ìš© !!!!!!
print(f'ê²€ì •í†µê³„ëŸ‰: {W:.3f}, ìœ ì˜í™•ë¥ : {p:.3f}')
```
<br>

**ì •ê·œì„± ê²€ì • ê²°ê³¼ ì •ë¦¬**

| êµ¬ë¶„ | ë‚´ìš© |
|---|---|
| **í•´ì„** | - ê·€ë¬´ê°€ì„¤: ë°ì´í„°ê°€ ì •ê·œë¶„í¬ë¥¼ ë”°ë¥¸ë‹¤.<br>-  ëŒ€ë¦½ê°€ì„¤: ë°ì´í„°ê°€ ì •ê·œë¶„í¬ë¥¼ ë”°ë¥´ì§€ ì•ŠëŠ”ë‹¤.<br>-  ìœ ì˜í™•ë¥ (p=0.000)ì´ ìœ ì˜ìˆ˜ì¤€(Î±=0.05)ë³´ë‹¤ ë§¤ìš° ì‘ìŒ.<br>-  ë”°ë¼ì„œ ê·€ë¬´ê°€ì„¤ì„ ê¸°ê°í•¨. |
| **ê²°ë¡ ** | -  ë°ì´í„°ëŠ” ì •ê·œë¶„í¬ë¥¼ ë”°ë¥´ì§€ ì•ŠìŒ. |
| **ì•ìœ¼ë¡œì˜ ë°©í–¥** | -  ì •ê·œì„± ê°€ì •ì´ ìœ„ë°°ë˜ë¯€ë¡œ ëª¨ìˆ˜ì  ê²€ì •(t-ê²€ì •, ANOVA ë“±) ì ìš© ì‹œ ì£¼ì˜ í•„ìš”<br>-  ë¹„ëª¨ìˆ˜ì  ë°©ë²•(Kruskal-Wallis ë“±) ê³ ë ¤ ê¶Œì¥ |


#### âŒ ì •ê·œì„± ê²€ì • Q-Q í”Œë¡¯
```{python}
# echo : false
# ì•„ë…¸ë°” ê²€ì • ê²°ê³¼
# ì”ì°¨ ì •ê·œì„± ê²€ì • ê²°ê³¼ ì¶œë ¥í•´ì•¼í•˜ëŠ” ë‚´ìš© !!!!!!
from scipy.stats import probplot
_=plt.figure(figsize=(6, 6))
_=probplot(model.resid, dist="norm", plot=plt)
# í•´ì„ ì”ì°¨ ì •ê·œì„± ë§Œì¡±ì•ˆí•¨
```
 

#### âŒ Bartlett ë“±ë¶„ì‚°ì„± ê²€ì •
- Bartlett ë“±ë¶„ì‚°ì„± ê²€ì • í†µê³¼

```{python}
#|echo : false
# bartlettì„ ì‚¬ìš©í•œ ì”ì°¨ì˜ ë“±ë¶„ì‚°ì„± ê²€ì¦ ê²°ê³¼ ë“±ë¶„ì‚°ì„± ì—­ì‹œ ì„±ë¦½í•˜ì§€ ì•ŠìŒ
from scipy.stats import bartlett
from scipy.stats import kruskal
groups = [1, 2, 3, 4]
grouped_residuals = [model.resid[dataset['Risk_Level'] == group] for group in groups]
test_statistic, p_value = bartlett(*grouped_residuals)
# ì•„ë…¸ë°” ê²€ì • ê²°ê³¼
# ì¶œë ¥í•´ì•¼ í•˜ëŠ” ë‚´ìš©!!!
print(f"ê²€ì •í†µê³„ëŸ‰: {test_statistic}, p-value: {p_value}")

```

<br>

**Bartlett ë“±ë¶„ì‚°ì„± ê²€ì • ê²°ê³¼ ì •ë¦¬**

| êµ¬ë¶„ | ë‚´ìš© |
|---|---|
| **í•´ì„** | - ê·€ë¬´ê°€ì„¤: ëª¨ë“  ê·¸ë£¹ì˜ ë¶„ì‚°ì´ ë™ì¼í•˜ë‹¤.<br>- ëŒ€ë¦½ê°€ì„¤: ì ì–´ë„ í•˜ë‚˜ì˜ ê·¸ë£¹ì´ ë‹¤ë¥¸ ë¶„ì‚°ì„ ê°€ì§„ë‹¤.<br>- ê²€ì •í†µê³„ëŸ‰: 68.78141877647354<br>- ìœ ì˜í™•ë¥ (p=7.78e-15)ì´ ìœ ì˜ìˆ˜ì¤€(Î±=0.05)ë³´ë‹¤ ë§¤ìš° ì‘ìŒ.<br>- ë”°ë¼ì„œ ê·€ë¬´ê°€ì„¤ì„ ê¸°ê°í•¨. |
| **ê²°ë¡ ** | - ìœ„í—˜ë„ ê·¸ë£¹ ê°„ ë¶„ì‚°ì´ ë™ì¼í•˜ì§€ ì•ŠìŒ.<br>- ë“±ë¶„ì‚°ì„± ê°€ì •ì´ ìœ„ë°°ë¨. |
| **ì•ìœ¼ë¡œì˜ ë°©í–¥** | - ë“±ë¶„ì‚°ì„± ê°€ì •ì´ ìœ„ë°°ë˜ë¯€ë¡œ í‘œì¤€ ANOVA ì‚¬ìš© ì‹œ ì£¼ì˜ í•„ìš”<br>- ë“±ë¶„ì‚°ì„±ì„ ê°€ì •í•˜ì§€ ì•ŠëŠ” Welch ANOVA ê³ ë ¤<br>- ë¹„ëª¨ìˆ˜ì  ë°©ë²•(Kruskal-Wallis ë“±) ì‚¬ìš© ê¶Œì¥<br>- ë°ì´í„° ë³€í™˜(ë¡œê·¸ ë³€í™˜ ë“±)ì„ í†µí•œ ë¶„ì‚° ì•ˆì •í™” ê³ ë ¤ ê°€ëŠ¥ |

:::
:::

### Column {width=50%}

::: {.card title="ğŸ“Š ìœ„í—˜ë“±ê¸‰ì— ë”°ë¥¸ ì£¼íƒê°€ê²© (ë¹„ëª¨ìˆ˜)"}
::: {.panel-tabset}
## âœ… Kruskal-Wallis ê²€ì •
-  Kruskal-Wallis ê²€ì •(ë¹„ëª¨ìˆ˜ ê²€ì •)ì„ í†µí•´ `ìœ„í—˜ë„ë³„ ì£¼íƒ í‰ë‹¨ê°€`ì˜ ì°¨ì´ê°€ í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œì§€ í™•ì¸
```{python}
# | echo: false
# ì•„ë…¸ë°” ê²€ì •ê²°ê³¼ x ì—¬ê¸°ë¶€í„° ë¹„ëª¨ìˆ˜ ê²€ì • ë¶€ë¶„ step12 ë‚˜ëˆ„ëŠ”ê±°ë¡œ í•´ì•¼í• ë“¯
# ë”°ë¼ì„œ Kruskal-Wallis ê²€ì • (ë¹„ëª¨ìˆ˜ ê²€ì •)ì„ í†µí•´ ìœ„í—˜ë„ë³„ ì£¼íƒ í‰ë‹¨ê°€ì˜ ì°¨ì´ê°€ í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œì§€ í™•ì¸
grouped = [group['BuildingPricePerTotalSF'].values for name, group in dataset.groupby('Risk_Level')]

kruskal_stat, kruskal_p = kruskal(*grouped)

# Kruskal-Wallis ê²€ì •ê²°ê³¼
kruskal_result = {
    "ê²€ì •í†µê³„ëŸ‰ (H)": kruskal_stat,
    "p-value": kruskal_p,
    "ê²°ë¡ ": "âœ”ï¸ ê·¸ë£¹ ê°„ ì°¨ì´ê°€ ìœ ì˜í•¨ (p < 0.05)" if kruskal_p < 0.05 else "âŒ ìœ ì˜í•œ ì°¨ì´ ì—†ìŒ (p â‰¥ 0.05)"
}
# ìœ„í—˜ë„ë³„ ì£¼íƒ í‰ë‹¨ê°€ ì°¨ì´ê°€ í•˜ë‚˜ ì´ìƒì€ ì¡´ì¬í•¨ì„ í™•ì¸
# ë”°ë¼ì„œ ì‚¬í›„ê²€ì •ì„ í†µí•´ ì–´ë–¤ ìœ„í—˜ë„ë¼ë¦¬ ì°¨ì´ê°€ ìˆëŠ”ì§€ í™•ì¸

# ì¶œë ¥í•´ì•¼í•˜ëŠ” ê²°ê³¼

# ë”•ì…”ë„ˆë¦¬ë¥¼ DataFrameìœ¼ë¡œ ë³€í™˜í•˜ì—¬ í‘œ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥
kruskal_df = pd.DataFrame(data={'ê°’': kruskal_result}).reset_index().rename(columns={'index': 'í•­ëª©'})
kruskal_df
```


## âœ… Dunn-test ê²°ê³¼
- Dunn-test(ë¹„ëª¨ìˆ˜ ì‚¬í›„ê²€ì •) ê²°ê³¼

- ì¼ë¶€ ê·¸ë£¹ ê°„ ìœ ì˜í•œ ì°¨ì´ ì¡´ì¬í•˜ëŠ”ì§€ ê²€ì •
- ë¹„ëª¨ìˆ˜ ì‚¬í›„ê²€ì • ì‹¤ì‹œ ê²°ê³¼ ìœ„í—˜ë„ 2ì™€ ê¸°íƒ€ ìœ„í—˜ë„ ê°„ì˜ ì°¨ì´ë§Œ ìœ ì˜ë¯¸í•¨
- ìœ„í—˜ë„ 1,3,4ê°„ì˜ ì°¨ì´ëŠ” ìœ ì˜ë¯¸ í•˜ì§€ ì•ŠìŒ
```{python}
# dunn-test(ë¹„ëª¨ìˆ˜ ì‚¬í›„ê²€ì •)

import scikit_posthocs as sp
posthoc = sp.posthoc_dunn(dataset, val_col='BuildingPricePerTotalSF', group_col='Risk_Level', p_adjust='bonferroni')
# ë¹„ëª¨ìˆ˜ ì‚¬í›„ê²€ì • ì‹¤ì‹œ ê²°ê³¼ ìœ„í—˜ë„ 2ë§ê³ ëŠ” ì°¨ì´ê°€ ìˆìŒì„ í™•ì¸ ë¶ˆê°€
# ê²°ê³¼ë³´ì—¬ì£¼ê¸° ìœ„í•´ ì¶œë ¥í•´ì•¼í•˜ëŠ” ë¶€ë¶„
posthoc
```
:::
:::

## Row {height=30%}
### Column {width=50%}
::: {.card title="ğŸ“ˆ ìœ„í—˜ë„ë³„ ì£¼íƒê°€ê²© Bar Plot"}

```{python}
#| echo: false

# í•˜ë‚˜ì˜ ê·¸ë˜í”„ë¡œ í‰ê· ê³¼ ì¤‘ì•™ê°’ ë¹„êµ
fig, ax = plt.subplots(figsize=(8, 5))
mean_RiskLevel.sort_index().plot(kind='bar', position=0, width=0.4, color='salmon', edgecolor='black', label='Mean', ax=ax)
median_RiskLevel.sort_index().plot(kind='bar', position=1, width=0.4, color='skyblue', edgecolor='black', label='Median', ax=ax)

_=ax.set_xlabel('Risk_Level', fontsize=20)
_=ax.set_ylabel('House Price', fontsize=20)
_=ax.set_title('Mean vs Median House Price by Risk Level', fontsize=20)
_=ax.grid(axis='y', linestyle='--', alpha=0.5)
_=ax.set_xticks(range(len(mean_RiskLevel)))
_=ax.set_xticklabels(mean_RiskLevel.index, rotation= 0)
_=ax.legend(fontsize=15)

plt.tight_layout()
plt.show()

```

:::

### Column {width=50%}
::: {.card title="ğŸ” ê²°ê³¼ í•´ì„"}

- âœ… **ìœ„í—˜ë„ 2ë“±ê¸‰ ì£¼íƒì€**  
â€ƒâ€ƒğŸ“ˆ **ë‹¤ë¥¸ ë“±ê¸‰ê³¼ ë¹„êµí•´ ì¤‘ì•™ê°’ ê¸°ì¤€ìœ¼ë¡œ í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•˜ê²Œ ë†’ì€ ê°€ê²©**ì„ ë³´ì˜€ìŠµë‹ˆë‹¤.

- â— í•˜ì§€ë§Œ,  
â€ƒâ€ƒ**ê·¸ ì™¸ ìœ„í—˜ë„ ê°„ì˜ ì¤‘ì•™ê°’ ê°€ê²© ì°¨ì´ëŠ” í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.**

- ğŸ‘‰ ë”°ë¼ì„œ,  
â€ƒâ€ƒ**ìœ„í—˜ë„ 2ì— í•´ë‹¹í•˜ëŠ” ì£¼íƒì€ ìƒëŒ€ì ìœ¼ë¡œ ë” ë¹„ì‹¼ í¸ì´ë¼ê³  í•´ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

**"âš  ë°ì´í„° í•´ì„ì˜ í•œê³„"**

- ğŸ§± **ë¶€ë™ì‚° ê°€ê²©ì€ ìì¬ ì™¸ì—ë„**  
â€ƒâ€ƒìœ„ì¹˜, ê±´ë¬¼ í¬ê¸°, ì—°ì‹, í† ì§€ ì¡°ê±´, ì§€ì—­ ìˆ˜ìš” ë“± **ë‹¤ì–‘í•œ ìš”ì¸ì˜ ì˜í–¥ì„ ë°›ìŠµë‹ˆë‹¤.**

- â“ **ì¦‰, ìì¬ ê¸°ë°˜ì˜ ìœ„í—˜ë„ë§Œìœ¼ë¡œëŠ”**  
â€ƒâ€ƒ**ì£¼íƒ ê°€ê²©ì˜ ëª¨ë“  ë³€ë™ì„±ì„ ì¶©ë¶„íˆ ì„¤ëª…í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.**

- ğŸ“Œ ë”°ë¼ì„œ,  
â€ƒâ€ƒ**ìœ„í—˜ë„ëŠ” 'ê°€ê²©ì— ì˜í–¥ì„ ì£¼ëŠ” ìš”ì¸ ì¤‘ í•˜ë‚˜'ì¼ ë¿ì´ë©°,  
â€ƒâ€ƒë‹¨ë… ìš”ì¸ìœ¼ë¡œ í•´ì„í•˜ëŠ”ë° í•œê³„ê°€ ìˆë‹¤.**



:::



# 4. ë³´í—˜ë£Œ ì‚°ì • ëª¨ë¸ë§

## Row {height=40%}

### Column {width=50%}
::: {.card title="ğŸ”§ ë³´í—˜ë£Œ ì˜ˆì¸¡ ëª¨ë¸"}

```{python}
#| echo: false

import joblib
dataloader = DataLoader()
ames = dataloader.load_data()
target = 'SalePrice'
y = ames[target]

ig_cols = ['PID','SalePrice','GeoRefNo','Prop_Addr','Latitude','Longitude','Risk_RoofMatl','Risk_Exterior1st','Risk_Exterior2nd','Risk_MasVnrType','Risk_WoodDeckSF']
X = ames.drop(columns=ig_cols)

# í•™ìŠµ/í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¶„í• 
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
predicted_model = joblib.load('../src/best_elastic_model/best_elastic_model.pkl')

predicted = predicted_model.predict(X_test)

test_df = pd.DataFrame(
    {'Test_ID': list(y_test.index),
        'Predicted': predicted,
        'Truth': y_test,
        'Resid': predicted - y_test})

_ = plt.figure(figsize=(8, 5))
_ = plt.scatter(test_df['Truth'], test_df['Predicted'], alpha=0.7, color='royalblue', label='Predicted vs Truth')
_ = plt.plot([min(test_df['Truth']), max(test_df['Truth'])], [min(test_df['Predicted']), max(test_df['Predicted'])], 'r--', label='Estimated Line')
_ = plt.xlabel('Truth', fontsize=20)
_ = plt.ylabel('Predicted', fontsize=20)
_ = plt.title('Trends of Residual')
_ = plt.legend()
_ = plt.grid(True)
_ = plt.tight_layout()
_ = plt.show()

```

- MSE:  25903.67405431691

- RMSE: 160.94618372088513

- $R^2$: 0.9999953867303233
:::

### Column {width=50%}
::: {.card title="ğŸ—ºï¸ ì˜ˆì¸¡ ë³´í—˜ë£Œ ì§€ë„ ì‹œê°í™”"}
```{python}
#| echo: false

import pandas as pd
import plotly.graph_objects as go

# ë³´í—˜ë£Œ ê³„ì‚° í•¨ìˆ˜
def cal_rate_criterion(level):
    if level == 1:
        return 0.95
    elif level == 2:
        return 0.975
    elif level == 3:
        return 1
    elif level == 4:
        return 1.025
    else:
        return 1.05

dataloader = DataLoader()
ames = dataloader.load_data()

# ì˜ˆì¸¡ ë³´í—˜ë£Œ ê³„ì‚°
ratio_additional = 0.003
ames['Estimate'] = (ames['SalePrice'] * ratio_additional) * ames['Risk_Level'].apply(cal_rate_criterion)

# ë³´í—˜ë£Œ 20% ë‹¨ìœ„ë¡œ ë“±ê¸‰í™”
quantiles = ames['Estimate'].quantile([0.2, 0.4, 0.6, 0.8])
def classify_estimate(value):
    if value <= quantiles[0.2]:
        return '1. ë§¤ìš° ë‚®ìŒ'
    elif value <= quantiles[0.4]:
        return '2. ë‚®ìŒ'
    elif value <= quantiles[0.6]:
        return '3. ë³´í†µ'
    elif value <= quantiles[0.8]:
        return '4. ë†’ìŒ'
    else:
        return '5. ë§¤ìš° ë†’ìŒ'

ames['Estimate_Level'] = ames['Estimate'].apply(classify_estimate)

# ìƒ‰ìƒ ë§¤í•‘ (í°ìƒ‰ â†’ ì§„í•œ ì£¼í™©)
color_map = {
    '1. ë§¤ìš° ë‚®ìŒ': '#ffffff',
    '2. ë‚®ìŒ': '#fff5cc',
    '3. ë³´í†µ': '#ffe066',
    '4. ë†’ìŒ': '#ffb600',
    '5. ë§¤ìš° ë†’ìŒ': '#ff8000'
}

# ì§€ë„ ë§ˆì»¤ êµ¬ì„±
traces = []
for level, color in color_map.items():
    df = ames[ames['Estimate_Level'] == level]
    traces.append(go.Scattermapbox(
        lat=df['Latitude'],
        lon=df['Longitude'],
        mode='markers',
        marker=dict(size=7, color=color, opacity=0.75),
        text='ê°€ê²©: $' + df['SalePrice'].astype(str) +
             '<br>ìœ„í—˜ë„: ' + df['Risk_Level'].astype(str) +
             '<br>ì˜ˆì¸¡ ë³´í—˜ë£Œ: $' + df['Estimate'].round(2).astype(str),
        name=level
    ))

# ì§€ë„ ë ˆì´ì•„ì›ƒ ì„¤ì •
layout_mapbox = dict(
    mapbox=dict(
        style="open-street-map",
        center=dict(lat=42.0345, lon=-93.62),
        zoom=11
    ),
    title=dict(
        text='ğŸ”¥ ì˜ˆì¸¡ ë³´í—˜ë£Œ ë“±ê¸‰ë³„ ì£¼íƒ ë¶„í¬',
        font=dict(size=22),
        x=0.05, xanchor='left'
    ),
    margin=dict(l=20, r=20, t=60, b=20),
    legend=dict(
        title=dict(text='<b>ì˜ˆì¸¡ ë³´í—˜ë£Œ ë“±ê¸‰</b>'),
        orientation='h',
        yanchor='bottom',
        y=0.02,
        xanchor='center',
        x=0.5,
        bgcolor='rgba(255, 255, 255, 0.8)',
        bordercolor='rgba(200, 200, 200, 0.8)',
        borderwidth=1,
        font=dict(size=12),
        itemsizing='constant',
    )
)

# ì‹œê°í™” ê²°ê³¼
fig = go.Figure(data=traces, layout=layout_mapbox)
fig  # QMDì—ì„œëŠ” figë§Œ ë‚¨ê²¨ì•¼ ì •ìƒ ì¶œë ¥

```
:::

## Row {height=20%}
::: {.card title="ğŸ’° ë³´í—˜ë£Œ ì‚°ì • ê³µì‹"}
$\mathbf{Y} =\big(P \cdot W_0 \big) \cdot W_1$

- $\mathbf{Y}$: ì˜ˆìƒ ë³´í—˜ì•¡
- $P$: ì˜ˆìƒ ë¶€ë™ì‚° ê±°ë˜ì•¡
- $W_0$: ì—°ê°„ í‰ê·  ì‚°ì • ë¶€ê°€ë¹„ìœ¨(0.03%)
- $W_1$: ìœ„í—˜ë„ë³„ ê°€ì¤‘ì¹˜ í‰ê· 

**ìœ„í—˜ë„ë³„ ê°€ì¤‘ì¹˜ ì±…ì • ê¸°ì¤€**


|  | ìœ„í—˜ë„1 | ìœ„í—˜ë„2 | ìœ„í—˜ë„3 | ìœ„í—˜ë„4 | ìœ„í—˜ë„5 |
| --- | --- | --- | --- | --- | --- |
| ê°€ì¤‘ì¹˜ ìˆ˜ì¹˜ | 0.95 | 0.975 | 1 | 1.025 | 1.05 |



:::


# 5. ì†ìµë¶„ê¸°ì  ë¶„ì„


## Row {height=70%}

::: {.card title="ğŸ“ˆ ì†ìµ ì‹œë‚˜ë¦¬ì˜¤ ê·¸ë˜í”„"}
```{python}
#|echo : false

dataloader = DataLoader()
ames = dataloader.load_data()

ratio_additional = 0.003
overall_cal_rate = ames['Risk_Level'].apply(cal_rate_criterion)
estimate = (ames['SalePrice'] * ratio_additional) * overall_cal_rate 
estimate = pd.Series(estimate, name='Estimate')

x_1_ticks_range = np.linspace(0.002, 0.004, len(ames))

mean_estimate = estimate.mean()
mean_sale_price = (ames['SalePrice'].mean() * 80) / 100


fig, ax = plt.subplots(figsize=(8,5))

_ = ax.axvline(x=0.00368*100, color='blue', linestyle='--')
_ = ax.text((0.00368 + 0.00002)*100, 400, 'x = 0.368%',
            rotation=0, color='blue', verticalalignment='center')
_ = ax.plot(x_1_ticks_range*100, [mean_estimate]*len(x_1_ticks_range), color='red', label='mean estimate')
_ = ax.plot(x_1_ticks_range*100, mean_sale_price*x_1_ticks_range, color='blue', label='mean sale price')

_ = ax.set_xlabel('Fire Claim Rate')
_ = ax.set_ylabel('Estimate')
_ = ax.set_title('Break Even of Estimate by Fire Claim')

_ = ax.grid(axis='y', linestyle='--', alpha=0.5)
_ = plt.xticks(rotation=0)
_ = plt.legend()

```
:::

## Row {height=20%}
::: {.card title="ğŸ“Œ ê²°ë¡  ìš”ì•½"}

- ğŸ”¥ **í™”ì¬(ì „ì†Œ) ë°œìƒë¥ ì´ ì•½ 0.368%ë¥¼ ì´ˆê³¼í•˜ë©´ ë³´í—˜ì‚¬ëŠ” ì†í•´ë¥¼ ë³¼ ê°€ëŠ¥ì„± ìˆìŒ**
    <tr> ğŸ‘‰ **ì¦‰, 10,000ê°€êµ¬ ì¤‘ 37ê°€êµ¬ ì´ìƒ í™”ì¬ ë°œìƒ ì‹œ ì†ì‹¤ ë°œìƒ**
  
- âœ… **0.368% ì´í•˜ë¡œ í™”ì¬ ë°œìƒë¥ ì„ ê´€ë¦¬í•  ê²½ìš° ìˆ˜ìµ í™•ë³´ ê°€ëŠ¥**

- ğŸ“Š **ê·¸ëŸ¬ë‚˜** ë³¸ ìˆ˜ì¹˜ëŠ” **"í‰ê·  í”¼í•´ ê¸ˆì•¡"ì„ ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°**ëœ ê¸°ëŒ€ê°’ì´ë©°,  
  **ì ˆëŒ€ê°’ì´ ì•„ë‹Œ í†µê³„ì  í‰ê·  ê¸°ì¤€**ì„ 
:::


